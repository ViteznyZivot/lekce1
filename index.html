<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bay Street: Vstup do Matrixu</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts: Antonio & Montserrat -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Antonio:wght@100..700&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

    <style>
        /* --- VISUAL IDENTITY: BAY STREET VISION --- */
        :root {
            /* The Void */
            --color-bg: #0A0A0A; 
            
            /* The Energy (Electric Cyan) */
            --energy-primary: #06b6d4; /* Cyan-500 */
            --energy-glow: #22d3ee;    /* Cyan-400 */
            --energy-deep: #0891b2;    /* Cyan-600 */

            /* The Structure */
            --structure-dark: #0f172a; /* Slate-900 */
            --structure-glass: rgba(10, 15, 20, 0.75);
            
            /* Phase Accents (Subtle) */
            --accent-gold: #fbbf24;
            --accent-purple: #a855f7;
            --accent-green: #4ade80;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--color-bg);
            color: #94a3b8; /* Light gray for body text to reduce eye strain */
            overflow-x: hidden;
            font-size: 16px;
            font-weight: 400;
            margin: 0;
        }

        h1, h2, h3, .brand-font {
            font-family: 'Antonio', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #ffffff; /* Pure white for headings */
        }

        /* --- THE VOID (CANVAS LAYER) --- */
        #matrix-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            background: radial-gradient(circle at center, #111827 0%, #000000 100%);
        }

        /* --- THE TECH (GLASSMORPHISM) --- */
        .glass-panel {
            background: var(--structure-glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(6, 182, 212, 0.2); /* Cyan tint border */
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.8), 
                        inset 0 0 0 1px rgba(255, 255, 255, 0.05);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .glass-panel:hover {
            border-color: rgba(6, 182, 212, 0.5);
            box-shadow: 0 0 30px rgba(6, 182, 212, 0.15),
                        inset 0 0 0 1px rgba(6, 182, 212, 0.1);
            transform: translateY(-2px);
        }

        /* --- UI ELEMENTS --- */
        .glow-text {
            text-shadow: 0 0 10px rgba(34, 211, 238, 0.5);
        }

        .btn-matrix {
            position: relative;
            background: rgba(6, 182, 212, 0.1);
            border: 1px solid var(--energy-primary);
            color: var(--energy-glow);
            font-family: 'Antonio', sans-serif;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(6, 182, 212, 0.2);
        }

        .btn-matrix::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(34, 211, 238, 0.4), transparent);
            transition: left 0.5s;
        }

        .btn-matrix:hover {
            background: rgba(6, 182, 212, 0.2);
            box-shadow: 0 0 25px rgba(6, 182, 212, 0.6);
            color: white;
            text-shadow: 0 0 8px rgba(255,255,255,0.8);
        }

        .btn-matrix:hover::before {
            left: 100%;
        }

        /* --- ANIMATIONS --- */
        .fade-in { animation: fadeIn 1.2s cubic-bezier(0.22, 1, 0.36, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .blink { animation: blink 2s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--energy-primary); }

        /* Intro Specific */
        #intro-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 100;
            pointer-events: none; /* Let clicks pass to canvas initially */
        }
        
        .init-btn {
            pointer-events: auto;
            opacity: 0;
            transform: scale(0.9);
            transition: all 1s ease;
        }
        
        .show-init {
            opacity: 1;
            transform: scale(1);
        }

    </style>
</head>
<body class="antialiased min-h-screen flex flex-col relative selection:bg-cyan-500 selection:text-black">

    <!-- The Void (Canvas) -->
    <canvas id="matrix-canvas"></canvas>

    <!-- Audio Ambience Visualizer (Simulated) -->
    <div class="fixed bottom-6 right-6 flex gap-1 items-end h-6 z-50 opacity-50">
        <div class="w-1 bg-cyan-500 animate-[pulse_1s_ease-in-out_infinite]" style="height: 40%"></div>
        <div class="w-1 bg-cyan-500 animate-[pulse_1.5s_ease-in-out_infinite]" style="height: 80%"></div>
        <div class="w-1 bg-cyan-500 animate-[pulse_1.2s_ease-in-out_infinite]" style="height: 60%"></div>
        <div class="w-1 bg-cyan-500 animate-[pulse_0.8s_ease-in-out_infinite]" style="height: 30%"></div>
    </div>

    <!-- Navigation -->
    <nav id="main-nav" class="fixed top-0 w-full z-40 glass-panel border-b border-cyan-500/10 hide transition-all duration-700 transform -translate-y-full opacity-0">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center gap-3">
                    <i data-lucide="aperture" class="text-cyan-400 w-8 h-8 animate-[spin_10s_linear_infinite]"></i>
                    <span class="brand-font font-bold text-2xl tracking-widest text-white">BAY STREET <span class="text-cyan-400 glow-text">NODE</span></span>
                </div>
                <div class="hidden md:block">
                    <div class="flex items-center space-x-1" id="nav-steps">
                        <!-- Nav items injected via JS -->
                    </div>
                </div>
                <div class="flex items-center gap-2 px-3 py-1 rounded-full border border-cyan-500/30 bg-cyan-500/5">
                    <div class="w-1.5 h-1.5 bg-cyan-400 rounded-full animate-pulse shadow-[0_0_10px_#22d3ee]"></div>
                    <span class="text-[10px] text-cyan-200 font-mono tracking-widest">CONNECTED</span>
                </div>
            </div>
        </div>
        <div class="h-[1px] w-full bg-gray-900">
            <div id="progress-bar" class="h-full bg-cyan-500 shadow-[0_0_15px_rgba(6,182,212,0.8)] transition-all duration-700" style="width: 0%"></div>
        </div>
    </nav>

    <!-- Intro Interaction Layer -->
    <div id="intro-overlay">
        <button id="init-button" class="init-btn btn-matrix px-12 py-4 rounded-sm text-xl font-bold tracking-[0.2em] backdrop-blur-md" onclick="initializeMatrix()">
            INITIALIZE SYSTEM
        </button>
        <p id="intro-hint" class="mt-4 text-cyan-500/50 font-mono text-xs tracking-widest uppercase blink init-btn">Waiting for signal...</p>
    </div>

    <!-- Main Content -->
    <main id="app-container" class="flex-grow flex items-center justify-center p-4 pt-24 min-h-screen opacity-0 transition-opacity duration-1000 z-10">
        <!-- Dynamic Content -->
    </main>

    <!-- Notification HUD -->
    <div id="toast" class="fixed bottom-10 left-10 glass-panel p-4 rounded-lg border-l-2 border-cyan-500 transform translate-y-40 transition-transform duration-500 z-50 flex items-center gap-4 max-w-sm shadow-[0_0_30px_rgba(0,0,0,0.8)]">
        <div class="p-2 bg-cyan-500/10 rounded-md">
            <i data-lucide="terminal" class="text-cyan-400 w-5 h-5"></i>
        </div>
        <div>
            <h4 class="text-[10px] uppercase text-gray-500 font-bold tracking-widest mb-0.5">Console Output</h4>
            <span id="toast-msg" class="text-sm font-medium text-cyan-100 block leading-tight font-mono">System Ready.</span>
        </div>
    </div>
    
    <script>
        // --- MATRIX CANVAS ENGINE ---
        const canvas = document.getElementById('matrix-canvas');
        const ctx = canvas.getContext('2d');
        
        let width, height;
        let particles = [];
        let mouse = { x: 0, y: 0 };
        let isInitialized = false;
        
        // Configuration
        const PARTICLE_COUNT = 150; // More particles for the network
        const CONNECT_DISTANCE = 120;
        
        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        class Particle {
            constructor() {
                this.x = width / 2; // Start at center (Singularity)
                this.y = height / 2;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.size = Math.random() * 2 + 1;
                this.color = `rgba(6, 182, 212, ${Math.random() * 0.5 + 0.2})`; // Cyan opacity
                
                // Singularity state variables
                this.angle = Math.random() * Math.PI * 2;
                this.radius = Math.random() * 50; // Cluster radius
                this.speed = Math.random() * 0.02 + 0.005;
            }

            update() {
                if (!isInitialized) {
                    // SINGULARITY MODE: Orbit around center/mouse
                    this.angle += this.speed;
                    const targetX = width/2 + Math.cos(this.angle) * this.radius;
                    const targetY = height/2 + Math.sin(this.angle) * this.radius;
                    
                    // Mouse interaction (Orbit distortion)
                    const dx = mouse.x - width/2;
                    const dy = mouse.y - height/2;
                    
                    this.x += (targetX + dx*0.1 - this.x) * 0.05;
                    this.y += (targetY + dy*0.1 - this.y) * 0.05;

                } else {
                    // NETWORK MODE: Float freely
                    this.x += this.vx;
                    this.y += this.vy;

                    // Mouse Interaction (Repel/Attract)
                    const dx = this.x - mouse.x;
                    const dy = this.y - mouse.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    if (dist < 200) {
                        const forceDirectionX = dx / dist;
                        const forceDirectionY = dy / dist;
                        const force = (200 - dist) / 200;
                        this.vx += forceDirectionX * force * 0.05;
                        this.vy += forceDirectionY * force * 0.05;
                    }

                    // Bounce off walls
                    if (this.x < 0 || this.x > width) this.vx *= -1;
                    if (this.y < 0 || this.y > height) this.vy *= -1;
                }
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                ctx.fill();
            }
        }

        function initParticles() {
            particles = [];
            for (let i = 0; i < PARTICLE_COUNT; i++) {
                particles.push(new Particle());
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            ctx.fillStyle = isInitialized ? 'rgba(10, 10, 10, 0.1)' : 'rgba(10, 10, 10, 0.2)'; // Trails
            ctx.fillRect(0, 0, width, height);

            particles.forEach(p => {
                p.update();
                p.draw();
            });

            // Draw connections only if initialized
            if (isInitialized) {
                connectParticles();
            } else {
                // Draw connecting lines to mouse in singularity mode to simulate "code trails"
                ctx.strokeStyle = 'rgba(6, 182, 212, 0.05)';
                ctx.beginPath();
                ctx.moveTo(width/2, height/2);
                ctx.lineTo(mouse.x, mouse.y);
                ctx.stroke();
            }
        }

        function connectParticles() {
            for (let i = 0; i < particles.length; i++) {
                for (let j = i; j < particles.length; j++) {
                    const dx = particles[i].x - particles[j].x;
                    const dy = particles[i].y - particles[j].y;
                    const dist = Math.sqrt(dx * dx + dy * dy);

                    if (dist < CONNECT_DISTANCE) {
                        ctx.beginPath();
                        ctx.strokeStyle = `rgba(6, 182, 212, ${1 - dist / CONNECT_DISTANCE})`;
                        ctx.lineWidth = 0.5;
                        ctx.moveTo(particles[i].x, particles[i].y);
                        ctx.lineTo(particles[j].x, particles[j].y);
                        ctx.stroke();
                    }
                }
            }
        }

        window.addEventListener('mousemove', (e) => {
            mouse.x = e.clientX;
            mouse.y = e.clientY;
            
            // Show Init button only if user interacts
            if (!isInitialized) {
                document.getElementById('init-button').classList.add('show-init');
                document.getElementById('intro-hint').classList.add('show-init');
            }
        });

        // Start Canvas
        initParticles();
        animate();


        // --- APP LOGIC ---

        function initializeMatrix() {
            isInitialized = true;
            
            // 1. Explode Particles
            particles.forEach(p => {
                p.vx = (Math.random() - 0.5) * 5; // Fast explosion
                p.vy = (Math.random() - 0.5) * 5;
            });

            // 2. Hide Intro UI
            const intro = document.getElementById('intro-overlay');
            intro.style.opacity = '0';
            setTimeout(() => intro.style.display = 'none', 1000);

            // 3. Show Main UI
            const nav = document.getElementById('main-nav');
            const app = document.getElementById('app-container');
            
            nav.classList.remove('hide', '-translate-y-full', 'opacity-0');
            nav.classList.add('translate-y-0', 'opacity-100');
            
            app.classList.remove('opacity-0');
            app.classList.add('opacity-100');

            // 4. Start App Flow
            initApp();
            showToast('NEURAL INTERFACE CONNECTED...', 'info');
        }

        // --- CONTENT STATE ---
        const STATE = {
            currentPhase: 0,
            phases: [
                { id: 'decentralization', title: '1. Síť', color: 'cyan' },
                { id: 'blockchain', title: '2. Deník', color: 'gold' },
                { id: 'consensus', title: '3. Shoda', color: 'blue' },
                { id: 'smartcontracts', title: '4. Automat', color: 'purple' },
                { id: 'web3', title: '5. Majetek', color: 'green' }
            ],
            blocks: [
                { id: 1, data: 'Karel -> Jana: 50 coinů', hash: '', prevHash: '00000000' },
                { id: 2, data: 'Jana -> Petr: 20 coinů', hash: '', prevHash: '' },
                { id: 3, data: 'Petr -> Item: Meč', hash: '', prevHash: '' }
            ],
            miningCount: 0
        };

        const $ = (s) => document.querySelector(s);
        const $$ = (s) => document.querySelectorAll(s);

        function showToast(msg, type = 'info') {
            const toast = $('#toast');
            const msgEl = $('#toast-msg');
            const icon = toast.querySelector('i');
            
            msgEl.innerText = msg;
            toast.classList.remove('translate-y-40');
            
            // Visual feedback
            let color = type === 'error' ? 'text-red-400' : (type === 'success' ? 'text-green-400' : 'text-cyan-400');
            icon.className = `${color} w-5 h-5`;
            
            if (type === 'error') toast.classList.replace('border-cyan-500', 'border-red-500');
            else toast.classList.replace('border-red-500', 'border-cyan-500');

            setTimeout(() => toast.classList.add('translate-y-40'), 4000);
        }

        function simpleHash(str) {
            let hash = 0;
            if (str.length === 0) return "00000000";
            for (let i = 0; i < str.length; i++) {
                hash = ((hash << 5) - hash) + str.charCodeAt(i);
                hash = hash & hash;
            }
            return Math.abs(hash).toString(16).padStart(8, '0');
        }

        function initApp() { renderPhase(0); }

        function setPhase(index) {
            STATE.currentPhase = index;
            renderPhase(index);
        }

        function nextPhase() {
            if (STATE.currentPhase < STATE.phases.length - 1) {
                setPhase(STATE.currentPhase + 1);
            }
        }

        function updateNav() {
            const list = $('#nav-steps');
            const progressBar = $('#progress-bar');
            
            list.innerHTML = '';
            
            STATE.phases.forEach((phase, idx) => {
                const active = idx === STATE.currentPhase;
                const completed = idx < STATE.currentPhase;
                
                const btn = document.createElement('button');
                btn.className = `px-3 py-1.5 rounded text-xs font-bold uppercase tracking-wider transition-all duration-300 ${active ? 'text-cyan-400 bg-cyan-500/10 border border-cyan-500/30 shadow-[0_0_10px_rgba(6,182,212,0.2)]' : 'text-gray-600 hover:text-gray-300'}`;
                btn.innerText = phase.title.split('. ')[1];
                btn.onclick = () => setPhase(idx);
                list.appendChild(btn);
            });

            const progress = ((STATE.currentPhase) / (STATE.phases.length - 1)) * 100;
            progressBar.style.width = `${progress}%`;
            
            lucide.createIcons();
        }

        function renderPhase(index) {
            const app = $('#app-container');
            const phase = STATE.phases[index];
            
            updateNav();
            app.innerHTML = '';
            
            let html = '';

            // --- PHASE 1: SÍŤ ---
            if (phase.id === 'decentralization') {
                html = `
                    <div class="w-full max-w-6xl fade-in">
                        <header class="mb-12 border-l-4 border-cyan-500 pl-6">
                            <h2 class="text-6xl text-white font-bold mb-2 tracking-tight">ARCHITEKTURA <span class="text-cyan-400 glow-text">SÍTĚ</span></h2>
                            <p class="text-xl text-gray-400 font-light">Centralizovaná Fragilita vs. Distribuovaná Odolnost</p>
                        </header>

                        <div class="grid md:grid-cols-2 gap-8">
                            <!-- Old World -->
                            <div class="glass-panel p-8 rounded-sm group cursor-pointer hover:border-red-500/50 transition-colors" onclick="hackCentral()">
                                <div class="flex justify-between items-start mb-8">
                                    <div>
                                        <h3 class="text-2xl text-white mb-1">LEGACY SYSTEM</h3>
                                        <span class="text-xs font-mono text-red-500/80 tracking-widest uppercase">Centralizované</span>
                                    </div>
                                    <i data-lucide="server-off" class="text-gray-600 group-hover:text-red-500 w-8 h-8 transition-colors"></i>
                                </div>
                                
                                <div id="central-network" class="h-64 bg-black/40 border border-white/5 relative flex items-center justify-center overflow-hidden">
                                    <div class="absolute inset-0 bg-[radial-gradient(#ffffff05_1px,transparent_1px)] [background-size:16px_16px]"></div>
                                    <!-- Center Node -->
                                    <div id="central-core" class="w-16 h-16 bg-gray-800 border border-gray-600 flex items-center justify-center z-10 transition-all duration-300 shadow-2xl">
                                        <i data-lucide="database" class="text-gray-400 w-6 h-6"></i>
                                    </div>
                                    <!-- Connections -->
                                    <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                                        <div class="w-full h-[1px] bg-gray-800 absolute top-1/2"></div>
                                        <div class="h-full w-[1px] bg-gray-800 absolute left-1/2"></div>
                                    </div>
                                    <div class="absolute bottom-4 text-[10px] text-gray-600 font-mono tracking-widest uppercase group-hover:text-red-500 transition-colors">Click to attack Mainframe</div>
                                </div>
                            </div>

                            <!-- New World -->
                            <div class="glass-panel p-8 rounded-sm group border-cyan-500/30">
                                <div class="flex justify-between items-start mb-8">
                                    <div>
                                        <h3 class="text-2xl text-white mb-1">DISTRIBUTED LEDGER</h3>
                                        <span class="text-xs font-mono text-cyan-400 tracking-widest uppercase">Decentralizované</span>
                                    </div>
                                    <i data-lucide="share-2" class="text-cyan-500 w-8 h-8"></i>
                                </div>
                                
                                <div class="h-64 bg-black/40 border border-cyan-500/10 relative p-8" id="mesh-grid">
                                    <!-- Nodes via JS -->
                                    <div class="grid grid-cols-3 gap-8 h-full items-center justify-items-center">
                                        ${[...Array(6)].map((_,i) => `
                                            <div onclick="hackNode(this)" class="w-10 h-10 bg-cyan-900/20 border border-cyan-500/50 rounded-full flex items-center justify-center cursor-pointer hover:bg-cyan-500 hover:text-black hover:shadow-[0_0_15px_#06b6d4] transition-all duration-300 mesh-node relative">
                                                <i data-lucide="network" class="w-4 h-4 text-cyan-400 pointer-events-none"></i>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                                <div class="text-right mt-4 text-[10px] text-cyan-500/50 font-mono tracking-widest">NODES ACTIVE: 6/6</div>
                            </div>
                        </div>
                        
                        <div class="mt-12 flex justify-end">
                             <button onclick="nextPhase()" class="btn-matrix px-8 py-3 flex items-center gap-4 group">
                                PŘEJÍT DÁL <i data-lucide="arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                            </button>
                        </div>
                    </div>
                `;
            }

            // --- PHASE 2: BLOCKCHAIN ---
            else if (phase.id === 'blockchain') {
                html = `
                    <div class="w-full max-w-6xl fade-in">
                        <header class="mb-12 border-l-4 border-yellow-500 pl-6">
                            <h2 class="text-6xl text-white font-bold mb-2 tracking-tight">IMMUTABLE <span class="text-yellow-400 glow-text">LEDGER</span></h2>
                            <p class="text-xl text-gray-400 font-light">Princip nezměnitelnosti dat pomocí kryptografických hashů.</p>
                        </header>

                        <div class="flex flex-col md:flex-row gap-6 overflow-x-auto pb-8 justify-center px-2">
                             ${STATE.blocks.map((block, idx) => `
                                <div id="block-${idx}" class="glass-panel p-6 w-full md:w-96 flex-shrink-0 relative group transition-all duration-500 hover:bg-white/5 border-t-2 ${idx===0 ? 'border-yellow-500' : 'border-gray-700'}">
                                    <div class="flex justify-between items-center mb-6 opacity-70">
                                        <span class="font-mono text-xs text-gray-400 tracking-widest">BLOCK_ID: 00${block.id}</span>
                                        ${idx===0 ? '<span class="text-[10px] bg-yellow-500/20 text-yellow-500 px-2 py-1 rounded">GENESIS</span>' : ''}
                                    </div>
                                    
                                    <div class="space-y-6">
                                        <div class="relative group/input">
                                            <label class="text-[10px] uppercase text-cyan-500 tracking-widest mb-2 block">Data Payload</label>
                                            <textarea oninput="updateBlockData(${idx}, this.value)" class="w-full bg-black/50 border border-gray-700 p-4 text-sm text-gray-300 font-mono focus:border-cyan-500 focus:outline-none focus:text-cyan-400 transition-colors h-24 resize-none block-input">${block.data}</textarea>
                                            <div class="absolute bottom-2 right-2 opacity-0 group-hover/input:opacity-100 transition-opacity">
                                                <i data-lucide="edit-3" class="w-3 h-3 text-gray-500"></i>
                                            </div>
                                        </div>
                                        
                                        <div class="grid grid-cols-1 gap-2">
                                            <div class="bg-black/30 p-2 border border-white/5 flex justify-between items-center">
                                                <span class="text-[10px] text-gray-600 uppercase">Prev</span>
                                                <span id="prev-${idx}" class="font-mono text-xs text-gray-500 truncate w-32 text-right">${block.prevHash}</span>
                                            </div>
                                            <div class="bg-black/30 p-2 border border-white/5 flex justify-between items-center relative overflow-hidden">
                                                <span class="text-[10px] text-gray-600 uppercase">Hash</span>
                                                <span id="hash-${idx}" class="font-mono text-xs text-yellow-500 truncate w-32 text-right font-bold relative z-10">...</span>
                                                <div class="absolute inset-0 bg-yellow-500/5"></div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    ${idx < STATE.blocks.length - 1 ? '<div class="hidden md:block absolute -right-3 top-1/2 -translate-y-1/2 z-10 text-gray-700"><i data-lucide="link" class="w-6 h-6"></i></div>' : ''}
                                </div>
                             `).join('')}
                        </div>

                        <div class="flex justify-center gap-6 mt-8">
                             <button onclick="cheatBlock()" class="px-6 py-3 border border-red-900/50 hover:bg-red-900/20 text-red-400 text-sm font-bold uppercase tracking-widest transition-all">
                                Simulate Attack
                            </button>
                             <button onclick="repairChain()" class="px-6 py-3 border border-green-900/50 hover:bg-green-900/20 text-green-400 text-sm font-bold uppercase tracking-widest transition-all">
                                Resync Nodes
                            </button>
                        </div>
                        
                        <div class="mt-12 flex justify-end">
                             <button onclick="nextPhase()" class="btn-matrix px-8 py-3 flex items-center gap-4 group">
                                PŘEJÍT DÁL <i data-lucide="arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                            </button>
                        </div>
                    </div>
                `;
                setTimeout(updateAllHashesDisplay, 100);
            }
            
            // --- PHASE 3: CONSENSUS ---
            else if (phase.id === 'consensus') {
                html = `
                    <div class="w-full max-w-5xl fade-in">
                        <header class="mb-12 border-l-4 border-blue-500 pl-6">
                            <h2 class="text-6xl text-white font-bold mb-2 tracking-tight">NETWORK <span class="text-blue-400 glow-text">CONSENSUS</span></h2>
                            <p class="text-xl text-gray-400 font-light">Algoritmy shody v distribuovaném prostředí.</p>
                        </header>

                        <div class="grid md:grid-cols-2 gap-8">
                            <!-- PoW -->
                            <div class="glass-panel p-8 relative overflow-hidden group">
                                <div class="absolute inset-0 bg-gradient-to-b from-yellow-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                <div class="flex items-center gap-4 mb-6 relative z-10">
                                    <div class="p-3 bg-yellow-500/10 rounded-full border border-yellow-500/20">
                                        <i data-lucide="cpu" class="w-6 h-6 text-yellow-500"></i>
                                    </div>
                                    <h3 class="text-2xl text-white font-bold">PROOF OF WORK</h3>
                                </div>
                                <p class="text-gray-400 text-sm mb-8 font-light leading-relaxed">
                                    Soutěž výpočetním výkonem. Těžaři hledají "nonce", aby validovali blok. Bezpečné, ale energeticky náročné.
                                </p>
                                
                                <div class="bg-black/40 p-6 border border-white/5 relative z-10">
                                    <div class="h-2 bg-gray-800 rounded-full overflow-hidden mb-4">
                                        <div id="mining-bar" class="h-full bg-yellow-500 w-0 transition-all duration-75"></div>
                                    </div>
                                    <button onclick="mineClick()" class="w-full py-4 border border-yellow-500/30 hover:bg-yellow-500/10 text-yellow-500 font-mono text-sm uppercase tracking-widest transition-all">
                                        INITIALIZE HASHING
                                    </button>
                                    <div id="mine-status" class="mt-2 text-[10px] font-mono text-gray-600 h-4">IDLE_STATE</div>
                                </div>
                            </div>

                            <!-- PoS -->
                            <div class="glass-panel p-8 relative overflow-hidden group">
                                <div class="absolute inset-0 bg-gradient-to-b from-blue-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                <div class="flex items-center gap-4 mb-6 relative z-10">
                                    <div class="p-3 bg-blue-500/10 rounded-full border border-blue-500/20">
                                        <i data-lucide="scale" class="w-6 h-6 text-blue-500"></i>
                                    </div>
                                    <h3 class="text-2xl text-white font-bold">PROOF OF STAKE</h3>
                                </div>
                                <p class="text-gray-400 text-sm mb-8 font-light leading-relaxed">
                                    Validátoři jsou vybráni na základě uzamčeného kapitálu (Stake). Ekonomická bezpečnost místo fyzické energie.
                                </p>
                                
                                <div class="bg-black/40 p-6 border border-white/5 relative z-10">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-[10px] text-gray-500 uppercase tracking-widest">Staked Amount</span>
                                        <span id="stake-val" class="font-mono text-blue-400">0 ETH</span>
                                    </div>
                                    <input type="range" min="0" max="100" value="0" class="w-full h-1 bg-gray-800 appearance-none cursor-pointer accent-blue-500 mb-6" oninput="updateStake(this.value)">
                                    
                                    <div class="flex justify-between items-end border-t border-white/5 pt-4">
                                        <span class="text-[10px] text-gray-500 uppercase">Probability</span>
                                        <span id="win-chance" class="text-2xl font-mono text-white">0%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-12 flex justify-end">
                             <button onclick="nextPhase()" class="btn-matrix px-8 py-3 flex items-center gap-4 group">
                                PŘEJÍT DÁL <i data-lucide="arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                            </button>
                        </div>
                    </div>
                `;
            }
            
            // --- PHASE 4: SMART CONTRACTS ---
            else if (phase.id === 'smartcontracts') {
                html = `
                    <div class="w-full max-w-5xl fade-in">
                        <header class="mb-12 border-l-4 border-purple-500 pl-6">
                            <h2 class="text-6xl text-white font-bold mb-2 tracking-tight">SMART <span class="text-purple-400 glow-text">CONTRACTS</span></h2>
                            <p class="text-xl text-gray-400 font-light">Deterministický kód. "If This, Then That" na blockchainu.</p>
                        </header>

                        <div class="glass-panel p-8 border-purple-500/20 relative overflow-hidden">
                            <div class="grid md:grid-cols-3 gap-8">
                                <!-- Code Logic -->
                                <div class="col-span-1 space-y-4 z-10">
                                    <div class="bg-black/60 p-4 border border-purple-500/20 font-mono text-xs text-gray-400 leading-loose">
                                        <span class="text-purple-400">function</span> execute() {<br>
                                        &nbsp;&nbsp;<span class="text-blue-400">if</span> (oracle.rain) {<br>
                                        &nbsp;&nbsp;&nbsp;&nbsp;transfer(100);<br>
                                        &nbsp;&nbsp;}<br>
                                        }
                                    </div>
                                    <button onclick="triggerContract()" class="w-full py-4 bg-purple-600/20 hover:bg-purple-600 text-white font-bold tracking-widest uppercase transition-all border border-purple-500/50 flex items-center justify-center gap-2">
                                        <i data-lucide="play" class="w-4 h-4"></i> Execute
                                    </button>
                                </div>

                                <!-- Visualizer -->
                                <div class="col-span-2 bg-gray-900/50 border border-white/5 relative h-64 overflow-hidden" id="contract-scene">
                                    <div class="absolute inset-0 grid grid-cols-3 items-center text-center z-20">
                                        <div>
                                            <i data-lucide="cloud" class="w-12 h-12 text-gray-600 mx-auto mb-2 transition-colors" id="icon-cloud"></i>
                                            <span class="text-[10px] uppercase tracking-widest text-gray-600">Oracle Data</span>
                                        </div>
                                        <div class="relative">
                                            <div class="h-[2px] w-full bg-gray-800"></div>
                                            <div id="flow-signal" class="absolute top-0 left-0 h-[2px] w-0 bg-purple-500 transition-all duration-1000"></div>
                                        </div>
                                        <div>
                                            <i data-lucide="wallet" class="w-12 h-12 text-gray-600 mx-auto mb-2 transition-colors" id="icon-wallet"></i>
                                            <span class="text-[10px] uppercase tracking-widest text-gray-600">User Wallet</span>
                                            <div id="wallet-balance" class="opacity-0 text-green-400 font-mono font-bold mt-1">+100 CR</div>
                                        </div>
                                    </div>
                                    <!-- Rain Layer -->
                                    <div id="rain-layer" class="absolute inset-0 pointer-events-none z-10"></div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-12 flex justify-end">
                             <button onclick="nextPhase()" class="btn-matrix px-8 py-3 flex items-center gap-4 group">
                                PŘEJÍT DÁL <i data-lucide="arrow-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                            </button>
                        </div>
                    </div>
                `;
            }
            
            // --- PHASE 5: ASSETS ---
            else if (phase.id === 'web3') {
                html = `
                    <div class="w-full max-w-5xl fade-in">
                        <header class="mb-12 border-l-4 border-green-500 pl-6">
                            <h2 class="text-6xl text-white font-bold mb-2 tracking-tight">DIGITAL <span class="text-green-400 glow-text">ASSETS</span></h2>
                            <p class="text-xl text-gray-400 font-light">Tokenizace a suverénní vlastnictví.</p>
                        </header>

                        <div class="grid md:grid-cols-2 gap-8">
                            <!-- NFT -->
                            <div class="glass-panel p-8 text-center border-green-500/20 hover:border-green-500/50 transition-colors">
                                <div class="w-48 h-48 mx-auto bg-gradient-to-t from-gray-900 to-black border border-green-500/30 mb-6 flex items-center justify-center relative group">
                                    <div class="absolute inset-0 bg-green-500/5 animate-pulse"></div>
                                    <i data-lucide="box" class="w-20 h-20 text-green-500 group-hover:scale-110 transition-transform duration-500"></i>
                                </div>
                                <h3 class="text-2xl text-white font-bold mb-1">NFT STANDARD</h3>
                                <p class="text-xs text-gray-500 font-mono mb-4">ERC-721 / UNIQUE ASSET</p>
                                <p class="text-gray-400 text-sm leading-relaxed">
                                    Digitální certifikát vlastnictví. Kód, který říká "toto je originál a patří této adrese".
                                </p>
                            </div>

                            <!-- DeFi -->
                            <div class="glass-panel p-8 flex flex-col justify-center border-green-500/20">
                                <div class="flex items-center gap-3 mb-6">
                                    <i data-lucide="trending-up" class="text-green-400 w-6 h-6"></i>
                                    <h3 class="text-2xl text-white font-bold">DECENTRALIZED FINANCE</h3>
                                </div>
                                <div class="bg-black/50 p-6 border border-white/5 mb-6">
                                    <div class="flex justify-between text-[10px] text-gray-500 uppercase tracking-widest mb-4">
                                        <span>Liquidity Pool</span>
                                        <span>APY: <span class="text-green-400">12%</span></span>
                                    </div>
                                    <input type="range" min="0" max="100" value="0" class="w-full h-1 bg-gray-800 appearance-none cursor-pointer accent-green-500 mb-6" oninput="updateYield(this.value)">
                                    <div class="text-center">
                                        <div class="text-4xl font-mono text-white tracking-tighter" id="yield-display">0.00</div>
                                        <div class="text-xs text-gray-600 mt-1 uppercase">Earned Tokens</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-16 text-center">
                            <button onclick="location.reload()" class="px-8 py-3 bg-white text-black font-bold uppercase tracking-widest hover:bg-gray-200 transition-colors">
                                Re-Initialize System
                            </button>
                        </div>
                    </div>
                `;
            }

            app.innerHTML = html;
            lucide.createIcons();
        }

        // --- INTERACTION LOGIC ---

        function hackCentral() {
            const core = $('#central-core');
            const container = $('#central-network');
            
            core.classList.remove('bg-gray-800');
            core.classList.add('bg-red-600', 'animate-pulse');
            container.style.borderColor = 'rgba(220, 38, 38, 0.5)';
            
            showToast('SYSTEM FAILURE: CENTRAL NODE COMPROMISED', 'error');
        }

        function hackNode(el) {
            if(el.classList.contains('bg-red-500')) return;
            el.classList.replace('bg-cyan-900/20', 'bg-red-500');
            el.classList.add('scale-90');
            
            // Pulse others
            $$('.mesh-node').forEach(n => {
                if(n !== el && !n.classList.contains('bg-red-500')) {
                    n.classList.add('bg-green-500', 'scale-110');
                    setTimeout(() => n.classList.remove('bg-green-500', 'scale-110'), 300);
                }
            });
            showToast('REROUTING TRAFFIC... NETWORK STABLE', 'info');
        }

        // Blockchain Logic
        function updateBlockData(idx, val) {
            STATE.blocks[idx].data = val;
            recalcHashes();
            updateUIHashes();
            checkChain();
        }

        function recalcHashes() {
            let prev = "00000000";
            STATE.blocks.forEach(b => {
                b.prevHash = prev;
                b.hash = simpleHash(b.id + b.prevHash + b.data);
                prev = b.hash;
            });
        }

        function updateUIHashes() {
            STATE.blocks.forEach((b, i) => {
                const h = $(`#hash-${i}`);
                if(h) h.innerText = b.hash;
                if(i < STATE.blocks.length - 1) {
                    const p = $(`#prev-${i+1}`);
                    if(p) p.innerText = b.hash;
                }
            });
        }

        function checkChain() {
            const valid = STATE.blocks[0].data.includes('50 coinů');
            $$('[id^="block-"]').forEach((el, i) => {
                if (i > 0) {
                    if (!valid) el.classList.add('border-red-500');
                    else el.classList.remove('border-red-500');
                }
            });
            if (!valid) showToast('CHAIN INVALID: HASH MISMATCH DETECTED', 'error');
        }
        
        function cheatBlock() {
            const ta = $('textarea');
            if(ta) { ta.value = "HACK: 99999 coins"; updateBlockData(0, ta.value); }
        }
        
        function repairChain() {
            STATE.blocks[0].data = "Karel -> Jana: 50 coinů";
            updateBlockData(0, STATE.blocks[0].data);
            $('textarea').value = STATE.blocks[0].data;
            showToast('LEDGER RESYNCED. INTEGRITY RESTORED.', 'info');
        }

        // Consensus Logic
        function mineClick() {
            const bar = $('#mining-bar');
            const status = $('#mine-status');
            
            STATE.miningCount += 10;
            bar.style.width = Math.min(STATE.miningCount, 100) + '%';
            status.innerText = 'HASHING: ' + Math.random().toString(16).substring(2, 8).toUpperCase();
            
            if (STATE.miningCount >= 100) {
                STATE.miningCount = 0;
                bar.style.width = '0%';
                status.innerText = 'BLOCK FOUND! NONCE: 2891';
                showToast('PROOF OF WORK ACCEPTED', 'info');
            }
        }

        function updateStake(val) {
            $('#stake-val').innerText = val + ' ETH';
            $('#win-chance').innerText = (val * 0.8).toFixed(1) + '%';
        }

        // Smart Contract Logic
        function triggerContract() {
            // Rain effect
            const rainLayer = $('#rain-layer');
            rainLayer.innerHTML = '';
            for(let i=0; i<30; i++) {
                const d = document.createElement('div');
                d.className = 'absolute bg-purple-500 w-[1px] h-4 opacity-50';
                d.style.left = Math.random() * 100 + '%';
                d.style.top = -10 + 'px';
                d.style.animation = `blink ${Math.random() * 0.5 + 0.5}s infinite`;
                rainLayer.appendChild(d);
            }
            
            $('#icon-cloud').classList.add('text-purple-400');
            showToast('ORACLE INPUT: RAIN DETECTED', 'info');
            
            setTimeout(() => {
                $('#flow-signal').classList.replace('w-0', 'w-full');
            }, 1000);
            
            setTimeout(() => {
                $('#icon-wallet').classList.add('text-green-400');
                $('#wallet-balance').classList.remove('opacity-0');
                showToast('CONTRACT EXECUTED: FUNDS TRANSFERRED', 'success');
            }, 2000);
            
            setTimeout(() => {
                 rainLayer.innerHTML = '';
                 $('#flow-signal').classList.replace('w-full', 'w-0');
                 $('#icon-cloud').classList.remove('text-purple-400');
            }, 4000);
        }

        // DeFi Logic
        function updateYield(val) {
            if (val > 0) {
                 if (!STATE.yieldInterval) {
                     STATE.yieldInterval = setInterval(() => {
                         let current = parseFloat($('#yield-display').innerText);
                         $('#yield-display').innerText = (current + 0.01 * (val/10)).toFixed(2);
                     }, 100);
                 }
            } else {
                clearInterval(STATE.yieldInterval);
                STATE.yieldInterval = null;
            }
        }

    </script>
</body>
</html>
